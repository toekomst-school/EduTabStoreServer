services:
  fdroid:
    build: .
    container_name: edutabstore-fdroid
    volumes:
      - fdroid-repo:/repo
      - fdroid-config:/config
      - fdroid-unsigned:/unsigned
    environment:
      - KEYSTOREPASS=${KEYSTOREPASS:-android}
      - ANDROID_HOME=/opt/android-sdk

  nginx:
    image: nginx:alpine
    container_name: edutabstore-nginx
    ports:
      - "80:80"
    volumes:
      - fdroid-repo:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - fdroid
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  fdroid-repo:
  fdroid-config:
  fdroid-unsigned:
